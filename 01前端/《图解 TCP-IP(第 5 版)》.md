# 第一章 网络基础知识

计算机网络根据规模可以分为：广域网（WAN: Wide Area Network）和局域网（LAN: Local Area Network）

协议的标准化：

-   国际标准化组织（ISO: International Organization for Standards）制定了一个国际标准开放式通信系统互联参考模型（OSI: Open Systems Interconnection），对通信系统进行了标准化
-   TCP/IP 通信协议是由 IETF（Internet Engineering Task Force） 所建议的一种协议

OSI 将通信分为 7 层，上下层之间交互遵循的约定叫 “接口”，同一层之间遵循的约定叫 “协议”。

OSI 仅是一个模型，定义了各层的作用，并没有对接口和协议进行详细的定义。

## OSI 参考模型各层作用

-   7 应用层：针对特定应用的协议，如：电子邮件、远程登录、文件传输等
-   6 表示层：设备固有数据格式和网络标准传输格式的转换，如：统一传输过程的文字、图片、声音的编码等
-   5 会话层：控制连接、数据分割，如：建立断开连接、规定连接保持多久
-   4 传输层：确保数据可靠传输（这层在通信双发节点处理无需再路由器上处理），如：当数据丢失告知源主机重新发送
-   3 网络层：将数据传输到目标地址（目标地址可以是多个网路通过路由器连接而形成的某一个地址），如：进行地址管理与路由选择
-   2 数据链路层：传输介质互连的设备间的数据处理，如：将 0,1 数据划分为有意义的数据帧，传输和识别数据帧
-   1 物理层：0,1 数据与电压和脉冲光的互换

## 传输方式分类

连接类型：有连接、无连接

通信方式：电路交换、分组交换

接收端数量：单播（Unicast）、广播（Broadcast）、多播（Muticast）、任播（Anycast）

## 地址

在网络通信中每层协议使用的地址都不尽相同，如在 TCP/IP 中使用 MAC 地址、IP 地址、端口号等信息作为地址的标识，应用层将电子邮件地址地址等作为网络通信地址。

地址应具有唯一性、层次性

## 网络构成的要素

| 设备                  | 作用                        |
| ------------------- | ------------------------- |
| 网卡 / 网络接口卡（NIC）     | 使计算机联网（Network Interface） |
| 中继器（Repeater）       | 从物理层延长网络                  |
| 网桥（Bridge）/ 2 层交换机  | 从数据链路层延长网络                |
| 路由器（Router）/ 3 层交换机 | 通过网络层转发分组数据               |
| 4 - 7 层交换机          | 处理传输层以上各层网络传输的设备          |
| 网关（Getaway）         | 转换协议的设备                   |

# 第二章 TCP/IP 基础知识

TCP: Transmission Control Protocol

IP: Internet Protocol

很多情况下 TCP/IP 指利用 IP 通信时所用到的协议族的统称

TCP/IP 协议的特点是开放性和实用性

TCP/IP 协议由 IETF 讨论制定，需要标准化的协议被列入 RFC（Request For Comment，官网 [» RFC Editor](https://www.rfc-editor.org/)）文档并在互联网公布

互联网中的每个网络都是由骨干网和末端网组成的，每个网络之间通过 NOC（Network Operation Center） 相连。互联网是众多异构网络通过 IX（Internet Exchange）互联的一个巨型网络。

连接互联网需要向 ISP 或区域网提出申请

## TCP/IP 协议族

-   应用协议：HTTP, SMTP, FTP, TELNET, SNMP
-   传输协议：TCP, UDP
-   网际协议：IP, ICMP, ARP
-   路由控制协议：RIP, OSPF, BGP

## TCP/IP 与 OSI 参考模型

| OSI 参考模型 | TCP/IP 分层模型  |
| -------- | ------------ |
| 应用层      | 应用层          |
| 表示层      | 应用层          |
| 会话层      | 应用层          |
| 传输层      | 传输层          |
| 网络层      | 互联网层         |
| 数据链路层    | 网络通信层（网络接口层） |
| 物理层      | 网络通信层（硬件层）   |

应用层协议：

-   HTTP：客户端与服务器通信
-   SMTP：电子邮件
-   FTP：文件传输，进行文件传输会建立两个 TCP 连接，一个用于控制传输请求，另一个用于实际传输数据
-   SSH 和 TELNET：远程登录
-   SNMP：网络管理，用于管理服务器、路由和交换机

## 例：TCP/IP 通信的过程

以发送电子邮件为例

1.  发送端应用程序处理：输入电子邮件内容，然后点击发送（**应用层**），这时会进行编码（UTP-8 或 GBK 等）处理（**表示层**），然后在合适的时机建立会话和发送数据（**会话层**）
2.  发送端 TCP 模块处理：TCP 根据应用层的指示建立连接、发送数据、发送数据时会在数据前加上 TCP 首部（**传输层**）
3.  发送端 IP 模块处理：IP 将 TCP 传来的数据加上 IP 首部，然后根据路由控制表将数据发给目标路由器或主机（**网络层**）
4.  发送端网络接口（以太网驱动）的处理：接收 IP 包加上以太网首部并通过物理层发送给接收端（**数据链路层**）
5.  接收端网络接口（以太网驱动）的处理：根据首部 MAC 地址判断是否为发送给自己的包，然后根据首部的上一层协议类型（这里是 IP）将数传给处理这种协议（这里是 IP）的程序（**数据链路层**）
6.  接收端 IP 模块处理：根据首部 IP 地址判断是否为发送给自己的包，然后传给上一层（这里是 TCP）的程序（**网络层**）
7.  接收端 TCP 模块处理：数据被完整接收后会传递给端口号识别的应用程序（**传输层**）
8.  接收端应用程序处理：在合适的时机建立会话和接收电子邮件数据（**会话层**），进行编码（**表示层**），然后进行验证和展示（**应用层**）

每个包首部都至少包括：1 发送端接收端地址，2 上一层协议类型

# 第三章 数据链路

数据链路可以视为网络传输中的最小单位，可以称互联网为” 数据链路的集合 “。

## MAC 地址

MAC 地址用于识别数据链路中互连的节点，使用网卡（NIC）的情况下，MAC 地址一般会被烧入到 ROM 中。

无论哪个协议成员通信设备设计前提都是 MAC 地址唯一。

交换机自学原理：交换机从源 MAC 地址学习到主机（MAC 地址）对应的交换机的端口，并在该主机（MAC 地址）作为目标时直接通过记录的端口发送。（如果未找到记录的主机（MAC 地址）则对所有未知主机（MAC 地址）的端口发送）

环路检测：生成树协议、源路由法

VLAN：不用修改网络布线，只用修改网络配置就可以实现网段的划分。

## 以太网（Ethernet）

我们平时用的网线、光纤连接的网络

## 无线通信

使用电磁波、红外线、激光等方式进行数据传播。包括：蓝牙（PAN）、WI-FI（LAN）、3G 和 4G（WAN）等等

## PPP

点对点连接计算机的协议：Point-to-Point Protocol

## 公共网络

-   模拟电话线路：使用电话线路进行通信，需要一个将数字信号转换为模拟信号的调制解调器（“猫”）
-   FTTH（FIber To The Home）：光纤到户
-   VPN：虚拟专用网络
-   公共无线 LAN：公开使用的 Wi-Fi

# 第四章 IP 协议

IP（IPv4、IPv6）相当于 OSI 参考模型中的第 3 层网络层，网络层的主要作用是 “实现终端节点之间的通信”。

IP 大致分为三大作用模块：IP 寻址、路由、以及 IP 分包和组包。

路由控制表：为了将数据包发给目标主机，所有主机都维护着一张路由控制表（Routing Table）。该表记录 IP 数据在下一步应该发给那个路由器。

不同数据链路的最大区别是她们的最大传输单位（MTU:Maximum Transmission Unit）不同，IP 可以将这种区别抽象化。

IP 属于面向无连接型，在发包之前无需建立连接。这样一是可以简化，二是可以提速。（IP 只会尽力做好发送数据的工作，TCP 属于面向有链接型会保证通信的可靠性）

## IP 地址的基础知识

IPv4 地址由 32 位正整数表示（32bit），2^32 大约为 43 亿，IP 地址分为网络标识和主机标识，这样一算实际上能连接到网络的计算机个数不是很多。

查看 IP：

-   windows `ipconfig`
-   unix `ifconfig`

IP 地址分类：

-   A 类：IP 地址为 0 开头，前 8 位为网络标识，后 24 位为主机标识
-   B 类：IP 地址为 10 开头，前 16 位为网络标识，后 16 位为主机标识
-   C 类：IP 地址为 110 开头，前 24 位为网络标识，后 8 位为主机标识
-   D 类：IP 地址为 1110 开头，前 32 位为网络标识，没有主机标识（经常用作多播）

IP 主机标识全为 0 表示 IP 地址不可知的情况，全为 1 通常作为广播地址，在分配过程中应该去除这两种情况。

子网掩码：因为用 IP 地址分类会造成浪费且不灵活，所以人们引入了子网掩码，自定义网络标识的长度，如需要 26 位的网络标识：

```text
IP: 172.20.100.52
子网掩码: 255.255.255.192

或

172.20.100.52/26
```

私有 IP 和全局 IP：

-   私用 IP：10/8、172.16/12、192.168/16、0/8、127/8，这些 IP 可以用在局域网防止冲突
-   全局 IP（公网 IP）：其他的地址，由 ICANN（Internet Corporation for Assigned Names and Numbers）进行管理

IP 报文的分片与重组：路由器会做分片但不会重组，重组在目标主机上进行。使用路径 MTU 发现可以缓存 MTU 的值让分片只在一开始进行一次。

IPv6：长度为 IPv4 的 4 倍（128bit），16bit 为一组分成 8 组

IPv4 和 IPv6 包首部：版本、源地址、目标地址、总长度、跳数限制、片偏移、数据等

# 第五章 IP 协议相关技术

## DNS

DNS（Domain Name System）将域名装换成 IP 地址。

使用`nslookup 主机名`会返回对应的 IP 地址。

域名具有分层结构，根（.）-> 一级域名（例如：com, cn 等）-> 二级域名（例如：baidu, zjffun 等）-> 三级域名（例如：www, blog 等）。。。

DNS 查询：解析器先从自己的数据库中找域名对应的 IP，找不到就向上一层进行查找

DNS 记录类型：

| 类型    | 内容               |
| ----- | ---------------- |
| A     | 主机名的 IP 地址（IPv4） |
| CNAME | 主机别名             |
| PTR   | IP 地址反向解析        |
| 等等。。。 |                  |

## ARP

ARP（Address Resolution Protocol）通过目标 IP 定位下一个接收数据分包的网络设备对应的 MAC 地址。

RARP（Reverse Address Resolution Protocol）吃泡面个 MAC 地址定位 IP 的协议，用于打印机等小型嵌入式设备接入网络。

# 第六章 TCP 与 UDP

# 第七章 路由协议

# 第八章 应用协议

# 第九章 网络安全

# 附录
